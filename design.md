# 天気情報確認アプリ 設計書

## 1. システム概要
### 1.1 目的
- 学習目的（API使用、`useForm`利用、状態管理、パラメーター付きURL）

### 1.2 構成
- フロントエンド: React + TypeScript + Tailwind
- バックエンド: Java + Spring Boot
- データベース: SQL
- 外部API: Open-Meteo API

### 1.3 処理概要
- ユーザーが都市名を入力
- 天気情報を取得
- 現在天気、気温、天気アイコン、風力を表示
- エラー時はエラーメッセージを表示

## 2. 画面設計
### 2.1 画面一覧
- `WeatherTopPage`（トップ兼検索画面）
- `WeatherResultSection`（天気表示セクション）
- `ErrorMessage`（`WeatherTopPage` 内で表示するコンポーネント）
- `LoadingIndicator`（`WeatherTopPage` 内で表示するコンポーネント）

### 2.2 画面要素
- 都市名入力フォーム
- 検索ボタン
- 天気アイコン
- 現在天気テキスト
- 気温表示
- 風力表示
- 占い表示エリア

### 2.3 レスポンシブ方針
- スマホファースト
- 画面幅に応じてカード幅を可変
- タップしやすいUI部品サイズを維持

## 3. 画面遷移・URL設計
### 3.1 ルーティング
- `/` : メイン画面

### 3.2 クエリパラメータ
- `city`: 検索対象都市名
- 例: `/ ?city=Tokyo`

### 3.3 URL直アクセス時の挙動
- `city` がある場合: 初期表示時に自動検索
- `city` がない場合: 入力待ち状態で表示
- 不正値の場合: エラー表示

## 4. 機能設計（MVP）
### 4.1 都市名検索
- 入力値を `useForm` で管理
- 送信時に `zod` による入力バリデーションを実施
- 正常時に天気取得処理を実行

### 4.2 現在天気表示
- 取得データを `useQuery` で管理
- 表示項目: 現在天気、気温、天気アイコン、風力

### 4.3 状態管理
- `isLoading`（`useQuery`）: 通信中フラグ
- `isError`（`useQuery`）: エラー状態フラグ
- `weatherData`: 天気データ
- `city`: 現在検索都市

### 4.4 バリデーション
- `zod` を利用
- 都市名の必須入力チェック
- 前後空白の除去
- 文字数上限100文字

### 4.5 エラーハンドリング
- API取得失敗時: 汎用エラーメッセージ表示
- 都市未検出時: 都市名確認メッセージ表示
- 通信タイムアウト時: リトライ案内表示

## 5. 機能設計（拡張）
### 5.1 拡張候補
- 花粉情報
- 占い情報
- 雨雲レーダー
- 検索履歴
- お気に入り都市

### 5.2 優先度
- 優先度高: 占い情報、履歴
- 優先度中: お気に入り都市
- 優先度低: 花粉情報、雨雲レーダー

## 6. データ設計
### 6.1 フロントエンド型定義（案）
```ts
export type WeatherViewData = {
  city: string;
  weatherText: string;
  temperature: number;
  windSpeed: number;
  iconCode: string;
};
```

### 6.2 バックエンド保持データ（拡張時）
- 検索履歴
- お気に入り都市

### 6.3 テーブル設計（案）
- `search_histories`（id, city, searched_at）
- `favorite_cities`（id, city, created_at）

## 7. API設計
### 7.1 外部API（Open-Meteo）
- 利用用途: 現在天気取得
- エンドポイント: `TBD`
- 必須パラメータ: 緯度、経度（都市名からの変換方法は `TBD`）

### 7.2 アプリ内API（必要時）
- `GET /api/weather?city={city}`
- 役割: 都市名解決 + Open-Meteo呼び出し + 表示用データ整形

### 7.3 エラー設計
- `400`: 入力不正
- `404`: 都市未検出
- `500`: サーバ内部エラー
- `503`: 外部API利用不可

## 8. 非機能設計
### 8.1 性能
- 検索から表示まで目標3秒以内（通常回線）

### 8.2 可用性
- API失敗時にユーザーへ再試行導線を表示

### 8.3 運用
- エラーログをサーバに記録
- クライアントでは最小限のログ出力

## 9. UI/UX詳細設計
### 9.1 デザイン方針
- シンプル
- パステルカラー

### 9.2 カラー案
- Primary: `#7DB9DE`
- Secondary: `#A8D8B9`
- Accent: `#F9D5A7`
- Background: `#F7F9FC`

### 9.3 アクセシビリティ
- 文字コントラスト比を確保
- キーボード操作可能
- 代替テキスト付与（天気アイコン）

## 10. テスト設計
### 10.1 単体テスト
- 入力バリデーション
- APIレスポンス整形
- 表示切替（loading/error/success）

### 10.2 結合テスト
- 都市名入力から結果表示までの一連動作

### 10.3 異常系テスト
- 空入力
- 不正都市名
- APIタイムアウト
- API 5xx

## 11. 開発・リリース設計
### 11.1 開発環境
- Node.js（フロント）
- JDK（バックエンド）
- SQL実行環境

### 11.2 環境変数
- `WEATHER_API_BASE_URL`
- `DB_URL`
- `DB_USER`
- `DB_PASSWORD`

### 11.3 デプロイ
- フロント: `TBD`
- バックエンド: `TBD`
- DB: `TBD`

## 12. スコープ外
- 通知機能
- アカウント設定
